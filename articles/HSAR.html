<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Hierarchical Spatial Simultaneous Autoregressive Model (HSAR) • HSAR</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Hierarchical Spatial Simultaneous Autoregressive Model (HSAR)">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">HSAR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/HSAR.html">An application of HSAR for asking prices in the municipality of Athens</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/spatlyu/HSAR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Hierarchical Spatial Simultaneous Autoregressive Model (HSAR)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/spatlyu/HSAR/blob/main/vignettes/HSAR.Rmd" class="external-link"><code>vignettes/HSAR.Rmd</code></a></small>
      <div class="d-none name"><code>HSAR.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="an-application-of-hsar-for-asking-prices-in-the-municipality-of-athens">An application of HSAR for asking prices in the municipality of
Athens<a class="anchor" aria-label="anchor" href="#an-application-of-hsar-for-asking-prices-in-the-municipality-of-athens"></a>
</h2>
<p>An application of <code><a href="../reference/hsar.html">hsar()</a></code>, based on rel data, will be
illustrated. The design of the weight matrices needed and the random
effect design matrix will be explained.</p>
<div class="section level4">
<h4 id="libraries">Libraries<a class="anchor" aria-label="anchor" href="#libraries"></a>
</h4>
<p>We start by loading the libraries that will be used.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spdep/" class="external-link">spdep</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">## ── Attaching core tidyverse packages ─────────────────────────────────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co">## ✔ dplyr     1.1.4     ✔ readr     2.1.5</span></span>
<span><span class="co">## ✔ forcats   1.0.0     ✔ stringr   1.5.1</span></span>
<span><span class="co">## ✔ ggplot2   3.5.1     ✔ tibble    3.2.1</span></span>
<span><span class="co">## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1</span></span>
<span><span class="co">## ✔ purrr     1.0.2     </span></span>
<span><span class="co">## ── Conflicts ───────────────────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">## ✖ tidyr::expand() masks Matrix::expand()</span></span>
<span><span class="co">## ✖ dplyr::filter() masks stats::filter()</span></span>
<span><span class="co">## ✖ dplyr::lag()    masks stats::lag()</span></span>
<span><span class="co">## ✖ tidyr::pack()   masks Matrix::pack()</span></span>
<span><span class="co">## ✖ tidyr::unpack() masks Matrix::unpack()</span></span>
<span><span class="co">## ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://spatlyu.github.io/HSAR/">HSAR</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="reading-the-datasets">Reading the datasets<a class="anchor" aria-label="anchor" href="#reading-the-datasets"></a>
</h4>
<p>At the higher level, we have the seven departments of the
municipality of Athens and at the lower level we have the point data of
the properties.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">depmunic</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">properties</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">depmunic</span><span class="op">)</span>,col <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html" class="external-link">sf.colors</a></span><span class="op">(</span><span class="fl">12</span>, categorical <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, border <span class="op">=</span> <span class="st">'grey'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">properties</span><span class="op">)</span>,add<span class="op">=</span><span class="cn">TRUE</span>,col<span class="op">=</span><span class="st">"red"</span>,pch<span class="op">=</span><span class="fl">16</span>,cex<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/hsar/p1-1.png"></p>
<p>The characteristics that come with the areal data are the id of the
department, the number of airbnb properties, the number of museums, the
population, the number of citizens with origin a non european union
country, the area of the green space (m^2) and the area of the polygon
(km^2).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">depmunic</span><span class="op">)</span></span>
<span><span class="co">## [1] "num_dep"    "airbnb"     "museums"    "population" "pop_rest"   "greensp"    "area"      </span></span>
<span><span class="co">## [8] "geometry"</span></span>
<span><span class="va">depmunic</span><span class="op">$</span><span class="va">pop_rest</span></span>
<span><span class="co">## [1]  8202  5009  2735  4167  5099 16531  8017</span></span></code></pre></div>
<p>The characteristics of the properties are the size (m^2), the asking
price (euros), the price per square meter, the age (years) and the
shortest distance to metro/train station (m).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">properties</span><span class="op">)</span></span>
<span><span class="co">## [1] "id"         "size"       "price"      "prpsqm"     "age"        "dist_metro" "geometry"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">properties</span><span class="op">$</span><span class="va">age</span>, xlab <span class="op">=</span> <span class="st">"Age"</span>, main<span class="op">=</span><span class="st">"Age of the properties"</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/hsar/p2-1.png"></p>
<p>Now we are going to create two more variables at the higher,
municipality department, level. The first one is the population density
per 10k citizens, and the second one is the percentage of non EU
citizens.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">depmunic</span><span class="op">$</span><span class="va">popdens</span> <span class="op">&lt;-</span> <span class="va">depmunic</span><span class="op">$</span><span class="va">population</span><span class="op">/</span> <span class="op">(</span><span class="fl">10000</span><span class="op">*</span><span class="va">depmunic</span><span class="op">$</span><span class="va">area</span><span class="op">)</span></span>
<span><span class="va">depmunic</span><span class="op">$</span><span class="va">foreigners</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">depmunic</span><span class="op">$</span><span class="va">pop_rest</span><span class="op">/</span> <span class="va">depmunic</span><span class="op">$</span><span class="va">population</span></span></code></pre></div>
<p>The next step is to create the model data that are going to use in
the hsar model. For that, we need for each property (lower data), the
data from the relevant department(higher level).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">properties_in_dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_join</a></span><span class="op">(</span><span class="va">properties</span>, <span class="va">depmunic</span>, join <span class="op">=</span> <span class="va">st_within</span><span class="op">)</span></span></code></pre></div>
<p>So now, we know each property, in which department resides and the
coresponding data for that polygon. We also need that data in sorting
order.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model.data</span> <span class="op">&lt;-</span> <span class="va">properties_in_dd</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">properties_in_dd</span><span class="op">$</span><span class="va">num_dep</span><span class="op">)</span>,<span class="op">]</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="create-matrices-used-in-the-hsar-function">Create matrices used in the hsar function<a class="anchor" aria-label="anchor" href="#create-matrices-used-in-the-hsar-function"></a>
</h4>
<p>In order to run the model we need to create the effect design matrix
(Delta), the weight matrix for the high-level - polygon data (M), and
the weight matrix for the lower level - point data (W).</p>
<p>In order to define the random effect matrix, we start with estimating
the number of properties in each municipality department</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">properties_count</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">model.data</span><span class="op">)</span>, <span class="va">num_dep</span><span class="op">)</span></span>
<span><span class="va">MM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">properties_count</span><span class="op">)</span></span></code></pre></div>
<p>and by geting the total number of municipality departments (7), we
define a vector with the number of municipality department that each
property belongs</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Utotal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">MM</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">Unum</span> <span class="op">&lt;-</span> <span class="va">MM</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">Uid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">Utotal</span><span class="op">)</span>,<span class="va">Unum</span><span class="op">)</span></span></code></pre></div>
<p>We then define the random effect matrix (Delta) wich has a dimension
of 1000x7</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">properties</span><span class="op">)</span></span>
<span><span class="va">Delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,nrow<span class="op">=</span><span class="va">n</span>,ncol<span class="op">=</span><span class="va">Utotal</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">Utotal</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">Delta</span><span class="op">[</span><span class="va">Uid</span><span class="op">==</span><span class="va">i</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">Delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">Delta</span>,<span class="st">"dgCMatrix"</span><span class="op">)</span></span></code></pre></div>
<p>Now we estimate the spatial weight matrix at the higher level which
in our case is the municipality departments (polygons). So we start with
poly2nb which constructs the neighbours list for polygons and then with
nb2mat we generate the weight matrix for the neighbours list previously
created. Then we transform the weight matrix in a sparse matrix
format.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nb.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html" class="external-link">poly2nb</a></span><span class="op">(</span><span class="va">depmunic</span><span class="op">)</span></span>
<span><span class="va">mat.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2mat.html" class="external-link">nb2mat</a></span><span class="op">(</span><span class="va">nb.list</span>,style<span class="op">=</span><span class="st">"W"</span><span class="op">)</span></span>
<span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">mat.list</span>,<span class="st">"dgCMatrix"</span><span class="op">)</span></span></code></pre></div>
<p>to have a closer look at M , we can visualize it</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">depmunic</span><span class="op">)</span>,border <span class="op">=</span> <span class="st">'grey'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="va">depmunic</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## Warning: st_centroid assumes attributes are constant over geometries</span></span>
<span><span class="co">## Warning in plot.sf(st_centroid(depmunic), add = TRUE): ignoring all but the first attribute</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nb.list</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="va">depmunic</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## Warning: st_centroid assumes attributes are constant over geometries</span></span></code></pre></div>
<p><img src="../reference/figures/hsar/p3-1.png"></p>
<p>Similarly, we create the spatial weight matrix at the lower level of
properties (point data). So we create the neighbour list at a distance
of 1300 meters</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nb.1300</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/dnearneigh.html" class="external-link">dnearneigh</a></span><span class="op">(</span><span class="va">properties</span>,<span class="fl">0</span>,<span class="fl">1300</span><span class="op">)</span></span></code></pre></div>
<p>and the weights matrix W as follows</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mat.1300</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2mat.html" class="external-link">nb2mat</a></span><span class="op">(</span><span class="va">nb.1300</span>,style<span class="op">=</span><span class="st">"W"</span><span class="op">)</span></span>
<span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">mat.1300</span>,<span class="st">"dgCMatrix"</span><span class="op">)</span></span></code></pre></div>
<p>For the W matrix, we can check the neighbours statistics</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nb.1300</span></span>
<span><span class="co">## Neighbour list object:</span></span>
<span><span class="co">## Number of regions: 1000 </span></span>
<span><span class="co">## Number of nonzero links: 170254 </span></span>
<span><span class="co">## Percentage nonzero weights: 17.0254 </span></span>
<span><span class="co">## Average number of links: 170.254</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="run-the-models">Run the models<a class="anchor" aria-label="anchor" href="#run-the-models"></a>
</h4>
<p>So, having ready the matrices Delta, M and W, we wun the
<code><a href="../reference/hsar.html">hsar()</a></code> function</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res.formula</span> <span class="op">&lt;-</span> <span class="va">prpsqm</span> <span class="op">~</span> <span class="va">size</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">greensp</span> <span class="op">+</span> <span class="va">population</span> <span class="op">+</span> <span class="va">museums</span> <span class="op">+</span> <span class="va">airbnb</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hsar.html">hsar</a></span><span class="op">(</span><span class="va">res.formula</span>,data<span class="op">=</span><span class="va">model.data</span>,W<span class="op">=</span><span class="va">W</span>,M<span class="op">=</span><span class="va">M</span>,Delta<span class="op">=</span><span class="va">Delta</span>,</span>
<span>            burnin<span class="op">=</span><span class="fl">500</span>, Nsim<span class="op">=</span><span class="fl">1000</span><span class="op">)</span></span>
<span><span class="co">## Warning in spdep::mat2listw(W): style is M (missing); style should be set to a valid value</span></span>
<span><span class="co">## Warning in sn2listw(df, style = style, zero.policy = zero.policy, from_mat2listw = TRUE):</span></span>
<span><span class="co">## style is M (missing); style should be set to a valid value</span></span>
<span><span class="co">## Warning in spdep::mat2listw(W): style is M (missing); style should be set to a valid value</span></span>
<span><span class="co">## Warning in sn2listw(df, style = style, zero.policy = zero.policy, from_mat2listw = TRUE):</span></span>
<span><span class="co">## style is M (missing); style should be set to a valid value</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## hsar(formula = res.formula, data = model.data, W = W, M = M, </span></span>
<span><span class="co">##     Delta = Delta, burnin = 500, Nsim = 1000)</span></span>
<span><span class="co">## Type:  hsar  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                      Mean           SD</span></span>
<span><span class="co">## (Intercept)  1.880468e+03 9.835447e+00</span></span>
<span><span class="co">## size         4.298802e+00 5.112041e-01</span></span>
<span><span class="co">## age         -1.995687e+01 1.304370e+00</span></span>
<span><span class="co">## greensp      8.404794e-04 8.738884e-04</span></span>
<span><span class="co">## population  -9.940391e-03 2.273935e-03</span></span>
<span><span class="co">## museums     -4.515772e+01 1.008513e+01</span></span>
<span><span class="co">## airbnb       6.022747e-01 2.496115e-01</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Spatial Coefficients:</span></span>
<span><span class="co">##           rho   lambda</span></span>
<span><span class="co">## [1,] 0.196536 0.018432</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Diagnostics </span></span>
<span><span class="co">## Deviance information criterion (DIC): 28193.01 </span></span>
<span><span class="co">## Effective number of parameters (pd): -1.66553 </span></span>
<span><span class="co">## Log likelihood: -14098.17 </span></span>
<span><span class="co">## Pseudo R squared: 0.3601049 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Impacts:</span></span>
<span><span class="co">##                    direct      indirect         total</span></span>
<span><span class="co">## (Intercept)  1.881082e+03  4.592335e+02  2.340316e+03</span></span>
<span><span class="co">## size         4.300207e+00  1.049821e+00  5.350028e+00</span></span>
<span><span class="co">## age         -1.996339e+01 -4.873715e+00 -2.483711e+01</span></span>
<span><span class="co">## greensp      8.407540e-04  2.052555e-04  1.046009e-03</span></span>
<span><span class="co">## population  -9.943639e-03 -2.427567e-03 -1.237121e-02</span></span>
<span><span class="co">## museums     -4.517248e+01 -1.102808e+01 -5.620055e+01</span></span>
<span><span class="co">## airbnb       6.024715e-01  1.470830e-01  7.495545e-01</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Quantiles:</span></span>
<span><span class="co">##                        5%           25%           50%           75%           95%</span></span>
<span><span class="co">## (Intercept)  1.864369e+03  1.874059e+03  1.880361e+03  1.887328e+03  1.896080e+03</span></span>
<span><span class="co">## size         3.436255e+00  3.956910e+00  4.291712e+00  4.628642e+00  5.155081e+00</span></span>
<span><span class="co">## age         -2.215863e+01 -2.075471e+01 -1.991798e+01 -1.911688e+01 -1.792525e+01</span></span>
<span><span class="co">## greensp     -3.546526e-04  2.905312e-04  7.376810e-04  1.261277e-03  2.657171e-03</span></span>
<span><span class="co">## population  -1.382163e-02 -1.159143e-02 -9.920309e-03 -8.353503e-03 -6.404121e-03</span></span>
<span><span class="co">## museums     -6.148110e+01 -5.224350e+01 -4.495013e+01 -3.850940e+01 -2.847943e+01</span></span>
<span><span class="co">## airbnb       1.776907e-01  4.578970e-01  6.114716e-01  7.457536e-01  1.010643e+00</span></span></code></pre></div>
<p>and the two simpler models defined for rho = 0 and lambda=0. So,
firstly, assuming rho = 0 (no interaction effects at the lower level) we
get</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hsar.html">hsar</a></span><span class="op">(</span><span class="va">res.formula</span>,data<span class="op">=</span><span class="va">model.data</span>,W<span class="op">=</span><span class="cn">NULL</span>,M<span class="op">=</span><span class="va">M</span>,Delta<span class="op">=</span><span class="va">Delta</span>,burnin<span class="op">=</span><span class="fl">500</span>, Nsim<span class="op">=</span><span class="fl">1000</span><span class="op">)</span></span>
<span><span class="co">## Warning in spdep::mat2listw(W): style is M (missing); style should be set to a valid value</span></span>
<span><span class="co">## Warning in sn2listw(df, style = style, zero.policy = zero.policy, from_mat2listw = TRUE):</span></span>
<span><span class="co">## style is M (missing); style should be set to a valid value</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">res_1</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## hsar(formula = res.formula, data = model.data, W = NULL, M = M, </span></span>
<span><span class="co">##     Delta = Delta, burnin = 500, Nsim = 1000)</span></span>
<span><span class="co">## Type:  hsar with rho = 0  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                      Mean           SD</span></span>
<span><span class="co">## (Intercept)  1.880592e+03 1.010450e+01</span></span>
<span><span class="co">## size         4.329009e+00 4.214029e-01</span></span>
<span><span class="co">## age         -2.004845e+01 1.258780e+00</span></span>
<span><span class="co">## greensp      6.812935e-04 6.843458e-04</span></span>
<span><span class="co">## population  -6.877688e-03 1.100394e-03</span></span>
<span><span class="co">## museums     -4.585817e+01 9.479326e+00</span></span>
<span><span class="co">## airbnb       6.288388e-01 2.222552e-01</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Spatial Coefficients:</span></span>
<span><span class="co">##    lambda </span></span>
<span><span class="co">## -0.130888 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Diagnostics </span></span>
<span><span class="co">## Deviance information criterion (DIC): 28196.24 </span></span>
<span><span class="co">## Effective number of parameters (pd): -1.988165 </span></span>
<span><span class="co">## Log likelihood: -14100.11 </span></span>
<span><span class="co">## Pseudo R squared: 0.3587056 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Quantiles:</span></span>
<span><span class="co">##                        5%           25%           50%           75%           95%</span></span>
<span><span class="co">## (Intercept)  1.863327e+03  1.874280e+03  1.880446e+03  1.887451e+03  1.897526e+03</span></span>
<span><span class="co">## size         3.648867e+00  4.026734e+00  4.331703e+00  4.647616e+00  5.040309e+00</span></span>
<span><span class="co">## age         -2.217344e+01 -2.090501e+01 -2.002926e+01 -1.916105e+01 -1.800675e+01</span></span>
<span><span class="co">## greensp     -5.464395e-04  3.468840e-04  7.498473e-04  1.081365e-03  1.660609e-03</span></span>
<span><span class="co">## population  -8.718853e-03 -7.542340e-03 -6.897453e-03 -6.200430e-03 -4.988964e-03</span></span>
<span><span class="co">## museums     -6.078241e+01 -5.205170e+01 -4.542701e+01 -3.995038e+01 -3.145765e+01</span></span>
<span><span class="co">## airbnb       2.844778e-01  4.953275e-01  6.164306e-01  7.496283e-01  9.872352e-01</span></span></code></pre></div>
<p>and secondly, given lambda = 0 (no interaction at the higher level)
we get</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hsar.html">hsar</a></span><span class="op">(</span><span class="va">res.formula</span>,data<span class="op">=</span><span class="va">model.data</span>,W<span class="op">=</span><span class="va">W</span>,M<span class="op">=</span><span class="cn">NULL</span>,Delta<span class="op">=</span><span class="va">Delta</span>,burnin<span class="op">=</span><span class="fl">500</span>, Nsim<span class="op">=</span><span class="fl">1000</span><span class="op">)</span></span>
<span><span class="co">## Warning in spdep::mat2listw(W): style is M (missing); style should be set to a valid value</span></span>
<span><span class="co">## Warning in sn2listw(df, style = style, zero.policy = zero.policy, from_mat2listw = TRUE):</span></span>
<span><span class="co">## style is M (missing); style should be set to a valid value</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">res_2</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## hsar(formula = res.formula, data = model.data, W = W, M = NULL, </span></span>
<span><span class="co">##     Delta = Delta, burnin = 500, Nsim = 1000)</span></span>
<span><span class="co">## Type:  hsar with lambda = 0  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                      Mean           SD</span></span>
<span><span class="co">## (Intercept)  1.880293e+03 9.970170e+00</span></span>
<span><span class="co">## size         4.271588e+00 4.581010e-01</span></span>
<span><span class="co">## age         -1.995568e+01 1.295576e+00</span></span>
<span><span class="co">## greensp      9.672711e-04 6.581401e-04</span></span>
<span><span class="co">## population  -9.434666e-03 2.083913e-03</span></span>
<span><span class="co">## museums     -4.545286e+01 1.035321e+01</span></span>
<span><span class="co">## airbnb       5.415177e-01 1.964108e-01</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Spatial Coefficients:</span></span>
<span><span class="co">##     rho </span></span>
<span><span class="co">## 0.19122 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Diagnostics </span></span>
<span><span class="co">## Deviance information criterion (DIC): 28196.99 </span></span>
<span><span class="co">## Effective number of parameters (pd): -1.752399 </span></span>
<span><span class="co">## Log likelihood: -14100.25 </span></span>
<span><span class="co">## Pseudo R squared: 0.3597633 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Quantiles:</span></span>
<span><span class="co">##                        5%           25%           50%           75%           95%</span></span>
<span><span class="co">## (Intercept)  1.864332e+03  1.873364e+03  1.880298e+03  1.886796e+03  1.896416e+03</span></span>
<span><span class="co">## size         3.550689e+00  3.944261e+00  4.254099e+00  4.559823e+00  5.073155e+00</span></span>
<span><span class="co">## age         -2.192657e+01 -2.079846e+01 -1.995871e+01 -1.909676e+01 -1.780104e+01</span></span>
<span><span class="co">## greensp      3.886899e-05  5.256176e-04  8.835621e-04  1.378462e-03  2.197482e-03</span></span>
<span><span class="co">## population  -1.282486e-02 -1.074985e-02 -9.589800e-03 -8.107401e-03 -6.107883e-03</span></span>
<span><span class="co">## museums     -6.271483e+01 -5.293104e+01 -4.448211e+01 -3.801137e+01 -2.948482e+01</span></span>
<span><span class="co">## airbnb       2.208243e-01  4.100049e-01  5.411334e-01  6.705060e-01  8.635070e-01</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Guanpeng Dong, Wenbo Lv, Richard Harris, Angelos Mimis.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
